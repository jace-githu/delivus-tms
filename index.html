<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QuickLog TMS - ì‹¤ì‹œê°„ ë°°ì†¡ê´€ë¦¬</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body, html {
            height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: hidden;
            background: #1a1a1a;
        }

        .app-container {
            display: flex;
            height: 100vh;
            width: 100vw;
        }

        /* ì‚¬ì´ë“œë°” */
        .sidebar {
            width: 380px;
            background: rgba(26, 26, 26, 0.95);
            backdrop-filter: blur(20px);
            border-right: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            flex-direction: column;
            color: white;
            position: relative;
            z-index: 1000;
            transition: transform 0.3s ease;
        }

        .sidebar.collapsed {
            transform: translateX(-340px);
        }

        .sidebar-toggle {
            position: absolute;
            right: -40px;
            top: 20px;
            width: 40px;
            height: 40px;
            background: rgba(26, 26, 26, 0.9);
            border: none;
            border-radius: 0 8px 8px 0;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            z-index: 1001;
            transition: all 0.3s ease;
        }

        .sidebar-toggle:hover {
            background: rgba(102, 126, 234, 0.8);
        }

        /* í—¤ë” */
        .header {
            padding: 1.5rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            background: rgba(102, 126, 234, 0.1);
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
        }

        .user-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .notification-btn {
            position: relative;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .notification-btn:hover {
            transform: scale(1.1);
            background: #764ba2;
        }

        .notification-badge {
            position: absolute;
            top: -3px;
            right: -3px;
            background: #ff4757;
            color: white;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            font-size: 0.6rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* í†µê³„ ì¹´ë“œ */
        .stats-section {
            padding: 1.5rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 1rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateY(-2px);
        }

        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .stat-title {
            font-size: 0.7rem;
            color: rgba(255, 255, 255, 0.7);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stat-icon {
            font-size: 1rem;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 0.25rem;
        }

        .stat-change {
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .positive { color: #2ed573; }
        .negative { color: #ff4757; }

        /* ì»¨íŠ¸ë¡¤ ì„¹ì…˜ */
        .controls-section {
            padding: 1.5rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .section-title {
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: rgba(255, 255, 255, 0.9);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .driver-chips {
            display: flex;
            flex-wrap: wrap;
            gap: 0.3rem;
            margin-bottom: 1rem;
            max-height: 120px;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: rgba(255, 255, 255, 0.3) transparent;
        }

        .driver-chips::-webkit-scrollbar {
            width: 4px;
        }

        .driver-chips::-webkit-scrollbar-track {
            background: transparent;
        }

        .driver-chips::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 2px;
        }

        .driver-chip {
            padding: 0.4rem 0.6rem;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            gap: 0.4rem;
            color: white;
        }

        .driver-chip:hover {
            background: rgba(102, 126, 234, 0.3);
        }

        .driver-chip.selected {
            background: #667eea;
            border-color: #5a67d8;
        }

        .driver-status {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            display: inline-block;
        }

        .status-active { background: #2ed573; }
        .status-busy { background: #ffa502; }
        .status-break { background: #ff4757; }

        .control-buttons {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .btn {
            padding: 0.75rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.8rem;
            font-weight: 500;
            transition: all 0.3s ease;
            text-align: center;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5a67d8;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        /* ë°°ì†¡ í˜„í™© */
        .delivery-section {
            flex: 1;
            padding: 1.5rem;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: rgba(255, 255, 255, 0.3) transparent;
        }

        .delivery-section::-webkit-scrollbar {
            width: 4px;
        }

        .delivery-section::-webkit-scrollbar-track {
            background: transparent;
        }

        .delivery-section::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 2px;
        }

        .search-bar {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            font-size: 0.8rem;
            margin-bottom: 1rem;
            transition: border-color 0.2s ease;
            background: rgba(255, 255, 255, 0.05);
            color: white;
        }

        .search-bar::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .search-bar:focus {
            outline: none;
            border-color: #667eea;
            background: rgba(255, 255, 255, 0.1);
        }

        .filter-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .filter-tab {
            padding: 0.4rem 0.8rem;
            border: none;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.7rem;
            color: rgba(255, 255, 255, 0.7);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .filter-tab.active {
            background: #667eea;
            color: white;
        }

        .filter-tab:not(.active):hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .delivery-list {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .delivery-item {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 1rem;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .delivery-item:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateX(3px);
        }

        .delivery-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .delivery-id {
            font-weight: bold;
            font-size: 0.8rem;
            color: #667eea;
        }

        .status-badge {
            padding: 0.2rem 0.6rem;
            border-radius: 10px;
            font-size: 0.6rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-pending { background: rgba(255, 165, 2, 0.2); color: #ffa502; border: 1px solid #ffa502; }
        .status-transit { background: rgba(102, 126, 234, 0.2); color: #667eea; border: 1px solid #667eea; }
        .status-delivered { background: rgba(46, 213, 115, 0.2); color: #2ed573; border: 1px solid #2ed573; }
        .status-delayed { background: rgba(255, 71, 87, 0.2); color: #ff4757; border: 1px solid #ff4757; }

        .delivery-address {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 0.5rem;
        }

        .delivery-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.7rem;
            color: rgba(255, 255, 255, 0.6);
        }

        .priority-high { color: #ff4757; font-weight: bold; }
        .priority-normal { color: rgba(255, 255, 255, 0.6); }

        /* ì§€ë„ ì˜ì—­ */
        .map-container {
            flex: 1;
            position: relative;
            height: 100vh;
        }

        #map {
            width: 100%;
            height: 100%;
        }

        /* ì§€ë„ ìœ„ í”Œë¡œíŒ… ì»¨íŠ¸ë¡¤ */
        .map-overlay {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .floating-control {
            background: rgba(26, 26, 26, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 0.75rem;
            color: white;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .floating-control:hover {
            background: rgba(102, 126, 234, 0.8);
            transform: translateY(-2px);
        }

        .alert-panel {
            position: absolute;
            bottom: 20px;
            left: 20px;
            right: 20px;
            background: rgba(255, 71, 87, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 71, 87, 0.3);
            border-radius: 8px;
            padding: 1rem;
            color: white;
            z-index: 1000;
            animation: slideUp 0.3s ease;
        }

        .alert-panel.warning {
            background: rgba(255, 165, 2, 0.9);
            border-color: rgba(255, 165, 2, 0.3);
        }

        .alert-panel.info {
            background: rgba(102, 126, 234, 0.9);
            border-color: rgba(102, 126, 234, 0.3);
        }

        .alert-title {
            font-weight: bold;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .alert-content {
            font-size: 0.8rem;
            opacity: 0.9;
        }

        .alert-close {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 1rem;
            opacity: 0.7;
        }

        .alert-close:hover {
            opacity: 1;
        }

        @keyframes slideUp {
            from {
                transform: translateY(100%);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        /* ë°˜ì‘í˜• */
        @media (max-width: 768px) {
            .sidebar {
                width: 320px;
            }
            
            .sidebar.collapsed {
                transform: translateX(-280px);
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .map-overlay {
                top: 10px;
                right: 10px;
            }
            
            .alert-panel {
                left: 10px;
                right: 10px;
                bottom: 10px;
            }
        }

        .animate-pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- ì‚¬ì´ë“œë°” -->
        <div class="sidebar" id="sidebar">
            <button class="sidebar-toggle" onclick="toggleSidebar()">
                <span id="toggleIcon">â†</span>
            </button>
            
            <!-- í—¤ë” -->
            <div class="header">
                <div class="logo">ë”œë¦¬ë˜ë¹— TMS</div>
                <div class="user-info">
                    <span>ê´€ë¦¬ì</span>
                    <button class="notification-btn" onclick="showNotifications()">
                        ğŸ””
                        <span class="notification-badge">3</span>
                    </button>
                </div>
            </div>

            <!-- í†µê³„ ì¹´ë“œ -->
            <div class="stats-section">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-header">
                            <span class="stat-title">ë°°ì†¡ì™„ë£Œ</span>
                            <span class="stat-icon">ğŸ“¦</span>
                        </div>
                        <div class="stat-value" style="color: #2ed573;">3,247</div>
                        <div class="stat-change positive">â†— +12.5%</div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-header">
                            <span class="stat-title">ë°°ì†¡ì¤‘</span>
                            <span class="stat-icon">ğŸšš</span>
                        </div>
                        <div class="stat-value" style="color: #667eea;">542</div>
                        <div class="stat-change positive">â†— +8.3%</div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-header">
                            <span class="stat-title">ì§€ì—°</span>
                            <span class="stat-icon">âš ï¸</span>
                        </div>
                        <div class="stat-value" style="color: #ff4757;">43</div>
                        <div class="stat-change negative">â†˜ -15.2%</div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-header">
                            <span class="stat-title">ì°¨ëŸ‰</span>
                            <span class="stat-icon">ğŸš›</span>
                        </div>
                        <div class="stat-value" style="color: #ffa502;">20</div>
                        <div class="stat-change positive">â†— +0%</div>
                    </div>
                </div>
            </div>

            <!-- ì»¨íŠ¸ë¡¤ ì„¹ì…˜ -->
            <div class="controls-section">
                <div class="section-title">
                    ğŸ—ºï¸ ì§€ë„ ì»¨íŠ¸ë¡¤
                </div>
                
                <div class="driver-chips" id="driverChips">
                    <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
                </div>

                <div class="control-buttons">
                    <button class="btn btn-primary" onclick="optimizeAllRoutes()">ì „ì²´ ê²½ë¡œ ìµœì í™”</button>
                    <button class="btn btn-secondary" onclick="refreshMap()">ì‹¤ì‹œê°„ ìƒˆë¡œê³ ì¹¨</button>
                    <button class="btn btn-secondary" onclick="toggleTraffic()">êµí†µì •ë³´ í‘œì‹œ</button>
                    <button class="btn btn-secondary" onclick="toggleDangerZones()">ìœ„í—˜ì§€ì—­ í‘œì‹œ</button>
                </div>
            </div>

            <!-- ë°°ì†¡ í˜„í™© -->
            <div class="delivery-section">
                <div class="section-title">
                    ğŸ“‹ ì‹¤ì‹œê°„ ë°°ì†¡ í˜„í™©
                </div>
                
                <input type="text" class="search-bar" placeholder="ìš´ì†¡ì¥ë²ˆí˜¸, ì£¼ì†Œ ê²€ìƒ‰..." onkeyup="filterDeliveries(this.value)">
                
                <div class="filter-tabs">
                    <button class="filter-tab active" onclick="filterByStatus('all')">ì „ì²´</button>
                    <button class="filter-tab" onclick="filterByStatus('pending')">ëŒ€ê¸°</button>
                    <button class="filter-tab" onclick="filterByStatus('transit')">ë°°ì†¡ì¤‘</button>
                    <button class="filter-tab" onclick="filterByStatus('delivered')">ì™„ë£Œ</button>
                </div>

                <div class="delivery-list" id="deliveryList">
                    <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
                </div>
            </div>
        </div>

        <!-- ì§€ë„ ì»¨í…Œì´ë„ˆ -->
        <div class="map-container">
            <div id="map"></div>
            
            <!-- í”Œë¡œíŒ… ì»¨íŠ¸ë¡¤ -->
            <div class="map-overlay">
                <div class="floating-control" onclick="centerMap()">
                    ğŸ“ ì§€ë„ ì¤‘ì‹¬í™”
                </div>
                <div class="floating-control" onclick="toggleFullscreen()">
                    â›¶ ì „ì²´í™”ë©´
                </div>
            </div>
            
            <!-- ì•Œë¦¼ íŒ¨ë„ -->
            <div class="alert-panel" id="alertPanel">
                <button class="alert-close" onclick="hideAlert()">Ã—</button>
                <div class="alert-title">âš ï¸ ê¸´ê¸‰ ì•Œë¦¼</div>
                <div class="alert-content">
                    ê°•ë‚¨êµ¬ ì¼ëŒ€ êµí†µì²´ì¦ ë°œìƒ - ìš°íšŒë¡œ ê¶Œì¥<br>
                    ì§€ì—° ë°°ì†¡ 3ê±´ ë°œìƒ, ëŒ€ì‘ í•„ìš”
                </div>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // ëœë¤ ì™„ë£Œ ì‹œê°„ ìƒì„±
        function generateRandomTime() {
            const hours = Math.floor(Math.random() * 8) + 9; // 9-17ì‹œ
            const minutes = Math.floor(Math.random() * 60);
            return `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}`;
        }

        // ì˜ˆìƒ ë„ì°© ì‹œê°„ ìƒì„±
        function generateEstimatedTime() {
            const hours = Math.floor(Math.random() * 4) + 14; // 14-17ì‹œ
            const minutes = Math.floor(Math.random() * 60);
            return `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}`;
        }

        // ë°°ì†¡ì§€ ìƒì„± í•¨ìˆ˜
        function generateDeliveries(driverId, minCoord, maxCoord, count) {
            const deliveries = [];
            const statuses = ['delivered', 'transit', 'pending', 'delayed'];
            const statusWeights = [0.6, 0.15, 0.2, 0.05]; // ì™„ë£Œ 60%, ë°°ì†¡ì¤‘ 15%, ëŒ€ê¸° 20%, ì§€ì—° 5%
            
            for (let i = 0; i < count; i++) {
                // ê°€ì¤‘ì¹˜ ê¸°ë°˜ ìƒíƒœ ì„ íƒ
                const random = Math.random();
                let status = 'pending';
                let cumulative = 0;
                for (let j = 0; j < statusWeights.length; j++) {
                    cumulative += statusWeights[j];
                    if (random <= cumulative) {
                        status = statuses[j];
                        break;
                    }
                }

                // ê¶Œì—­ ë‚´ ëœë¤ ìœ„ì¹˜ ìƒì„±
                const lat = minCoord[0] + Math.random() * (maxCoord[0] - minCoord[0]);
                const lng = minCoord[1] + Math.random() * (maxCoord[1] - minCoord[1]);
                
                // ì§€ì—­ë³„ ì£¼ì†Œ ìƒì„±
                const addresses = {
                    kim: ['ê°•ë‚¨êµ¬ í…Œí—¤ë€ë¡œ', 'ê°•ë‚¨êµ¬ ì—­ì‚¼ë™', 'ê°•ë‚¨êµ¬ ì‚¼ì„±ë™', 'ê°•ë‚¨êµ¬ ëŒ€ì¹˜ë™', 'ê°•ë‚¨êµ¬ ì²­ë‹´ë™'],
                    lee: ['ë§ˆí¬êµ¬ í™ëŒ€ì…êµ¬', 'ë§ˆí¬êµ¬ ì„œêµë™', 'ë§ˆí¬êµ¬ ì—°ë‚¨ë™', 'ë§ˆí¬êµ¬ í•©ì •ë™', 'ë§ˆí¬êµ¬ ìƒìˆ˜ë™'],
                    park: ['ì†¡íŒŒêµ¬ ì ì‹¤ë™', 'ì†¡íŒŒêµ¬ ì‹ ì²œë™', 'ì†¡íŒŒêµ¬ ì‚¼ì „ë™', 'ì†¡íŒŒêµ¬ ì„ì´Œë™', 'ì†¡íŒŒêµ¬ ì†¡íŒŒë™'],
                    choi: ['ì¢…ë¡œêµ¬ ì¢…ë¡œ3ê°€', 'ì¢…ë¡œêµ¬ ì¸ì‚¬ë™', 'ì¢…ë¡œêµ¬ í˜œí™”ë™', 'ì¢…ë¡œêµ¬ ì‚¼ì²­ë™', 'ì¢…ë¡œêµ¬ ì•ˆêµ­ë™'],
                    jung: ['ì„œì´ˆêµ¬ ì„œì´ˆë™', 'ì„œì´ˆêµ¬ ë°©ë°°ë™', 'ì„œì´ˆêµ¬ ì–‘ì¬ë™', 'ì„œì´ˆêµ¬ ë°˜í¬ë™', 'ì„œì´ˆêµ¬ ë‚´ê³¡ë™'],
                    kang: ['ì˜ë“±í¬êµ¬ ì—¬ì˜ë„', 'ì˜ë“±í¬êµ¬ ë‹¹ì‚°ë™', 'ì˜ë“±í¬êµ¬ ë¬¸ë˜ë™', 'ì˜ë“±í¬êµ¬ ì‹ ê¸¸ë™', 'ì˜ë“±í¬êµ¬ ëŒ€ë¦¼ë™'],
                    han: ['ì„±ë¶êµ¬ ì„±ë¶ë™', 'ì„±ë¶êµ¬ ëˆì•”ë™', 'ì„±ë¶êµ¬ ì •ë¦‰ë™', 'ì„±ë¶êµ¬ ì¥ìœ„ë™', 'ì„±ë¶êµ¬ ì„ê´€ë™'],
                    oh: ['ê´€ì•…êµ¬ ì‹ ë¦¼ë™', 'ê´€ì•…êµ¬ ë´‰ì²œë™', 'ê´€ì•…êµ¬ ë‚¨í˜„ë™', 'ê´€ì•…êµ¬ ì¤‘ì•™ë™', 'ê´€ì•…êµ¬ ì¸í—Œë™'],
                    shin: ['êµ¬ë¡œêµ¬ ì‹ ë„ë¦¼', 'êµ¬ë¡œêµ¬ êµ¬ë¡œë™', 'êµ¬ë¡œêµ¬ ê°€ë¦¬ë´‰', 'êµ¬ë¡œêµ¬ ê°œë´‰ë™', 'êµ¬ë¡œêµ¬ ì˜¤ë¥˜ë™'],
                    lim: ['ê°•ì„œêµ¬ í™”ê³¡ë™', 'ê°•ì„œêµ¬ ë“±ì´Œë™', 'ê°•ì„œêµ¬ ì—¼ì°½ë™', 'ê°•ì„œêµ¬ ë°œì‚°ë™', 'ê°•ì„œêµ¬ ê³µí•­ë™'],
                    yoon: ['ë…¸ì›êµ¬ ìƒê³„ë™', 'ë…¸ì›êµ¬ ì¤‘ê³„ë™', 'ë…¸ì›êµ¬ í•˜ê³„ë™', 'ë…¸ì›êµ¬ ê³µë¦‰ë™', 'ë…¸ì›êµ¬ ì›”ê³„ë™'],
                    song: ['ì¤‘ë‘êµ¬ ë©´ëª©ë™', 'ì¤‘ë‘êµ¬ ìƒë´‰ë™', 'ì¤‘ë‘êµ¬ ì¤‘í™”ë™', 'ì¤‘ë‘êµ¬ ë¬µë™', 'ì¤‘ë‘êµ¬ ë§ìš°ë™'],
                    moon: ['ê´‘ì§„êµ¬ ìì–‘ë™', 'ê´‘ì§„êµ¬ êµ¬ì˜ë™', 'ê´‘ì§„êµ¬ ì¤‘ê³¡ë™', 'ê´‘ì§„êµ¬ ëŠ¥ë™', 'ê´‘ì§„êµ¬ í™”ì–‘ë™'],
                    baek: ['ì–‘ì²œêµ¬ ëª©ë™', 'ì–‘ì²œêµ¬ ì‹ ì •ë™', 'ì–‘ì²œêµ¬ ì‹ ì›”ë™', 'ì–‘ì²œêµ¬ í™”ê³¡ë™', 'ì–‘ì²œêµ¬ ë“±ì´Œë™'],
                    nam: ['ì„œì´ˆêµ¬ ì ì›ë™', 'ì„œì´ˆêµ¬ ë°˜í¬ë™', 'ì„œì´ˆêµ¬ ì„œì´ˆë™', 'ì„œì´ˆêµ¬ ë°©ë°°ë™', 'ì„œì´ˆêµ¬ ì–‘ì¬ë™'],
                    go: ['ì„±ë‚¨ì‹œ ë¶„ë‹¹êµ¬', 'ì„±ë‚¨ì‹œ ìˆ˜ì •êµ¬', 'ì„±ë‚¨ì‹œ ì¤‘ì›êµ¬', 'ë¶„ë‹¹êµ¬ ì •ìë™', 'ë¶„ë‹¹êµ¬ ì„œí˜„ë™'],
                    hong: ['ìˆ˜ì›ì‹œ ì˜í†µêµ¬', 'ìˆ˜ì›ì‹œ ì¥ì•ˆêµ¬', 'ìˆ˜ì›ì‹œ ê¶Œì„ êµ¬', 'ìˆ˜ì›ì‹œ íŒ”ë‹¬êµ¬', 'ìˆ˜ì›ì‹œ ì—°ë¬´ë™'],
                    woo: ['ê³ ì–‘ì‹œ ì¼ì‚°êµ¬', 'ê³ ì–‘ì‹œ ë•ì–‘êµ¬', 'ì¼ì‚°ë™êµ¬', 'ì¼ì‚°ì„œêµ¬', 'ê³ ì–‘ì‹œ í™”ì •ë™'],
                    ahn: ['ë¶€ì²œì‹œ ì›ë¯¸êµ¬', 'ë¶€ì²œì‹œ ì†Œì‚¬êµ¬', 'ë¶€ì²œì‹œ ì˜¤ì •êµ¬', 'ë¶€ì²œì‹œ ì¤‘ë™', 'ë¶€ì²œì‹œ ìƒë™'],
                    jang: ['êµ¬ë¦¬ì‹œ ìˆ˜íƒë™', 'êµ¬ë¦¬ì‹œ ì¸ì°½ë™', 'êµ¬ë¦¬ì‹œ êµë¬¸ë™', 'êµ¬ë¦¬ì‹œ í† í‰ë™', 'êµ¬ë¦¬ì‹œ ê°ˆë§¤ë™']
                };
                
                const addressList = addresses[driverId] || ['ì„œìš¸ì‹œ ì¤‘êµ¬'];
                const randomAddress = addressList[Math.floor(Math.random() * addressList.length)];
                const buildingNumber = Math.floor(Math.random() * 999) + 1;

                deliveries.push({
                    id: `QS2024-${String(10000 + i + (Object.keys(driversData || {}).indexOf(driverId) * 100)).padStart(6, '0')}`,
                    position: [lat, lng],
                    address: `${randomAddress} ${buildingNumber}`,
                    status: status,
                    priority: Math.random() > 0.8 ? 'high' : 'normal',
                    completedAt: status === 'delivered' ? generateRandomTime() : null,
                    estimatedTime: status !== 'delivered' ? generateEstimatedTime() : null
                });
            }
            
            return deliveries.sort((a, b) => {
                const statusOrder = { 'transit': 0, 'delayed': 1, 'pending': 2, 'delivered': 3 };
                return statusOrder[a.status] - statusOrder[b.status];
            });
        }

        // ì „ì—­ ë³€ìˆ˜
        let map;
        let driverMarkers = {};
        let deliveryMarkers = {};
        let routeLines = {};
        let dangerZones = [];
        let dangerZonesVisible = false;
        let currentSelectedDriver = 'all';
        let currentDetailDriver = null;
        let sidebarCollapsed = false;

        // ìœ„í—˜ ì§€ì—­ ë°ì´í„°
        const dangerZoneData = [
            {
                name: 'ê°•ë‚¨êµ¬ í…Œí—¤ë€ë¡œ',
                center: [37.4988, 127.0368],
                radius: 800,
                level: 'high',
                reason: 'ê·¹ì‹¬í•œ êµí†µì²´ì¦'
            },
            {
                name: 'í™ëŒ€ì…êµ¬ ì¼ëŒ€',
                center: [37.5563, 126.9239],
                radius: 600,
                level: 'medium',
                reason: 'ì£¼ë§ ì¸íŒŒ ì§‘ì¤‘'
            },
            {
                name: 'ê°•ë³€ë¶ë¡œ',
                center: [37.5345, 127.0678],
                radius: 1200,
                level: 'medium',
                reason: 'ì‚¬ê³  ë‹¤ë°œ êµ¬ê°„'
            },
            {
                name: 'ì ì‹¤ ë¡¯ë°íƒ€ì›Œ',
                center: [37.5125, 127.1025],
                radius: 500,
                level: 'low',
                reason: 'ì£¼ì°¨ ê³µê°„ ë¶€ì¡±'
            }
        ];

        // 20ëª…ì˜ ê¸°ì‚¬ ë°ì´í„° (ì„œìš¸ + ìˆ˜ë„ê¶Œ) - í•¨ìˆ˜ í˜¸ì¶œ ì „ì— ì •ì˜
        const driversData = {};

        // ê¸°ì‚¬ ë°ì´í„° ì´ˆê¸°í™” í•¨ìˆ˜
        function initializeDriversData() {
            const driverConfigs = [
                { id: 'kim', name: 'ê¹€ê¸°ì‚¬', position: [37.5016, 127.0398], zone: 'ê°•ë‚¨ê¶Œ', color: '#2ed573', status: 'active', bounds: [[37.4888, 127.0268], [37.5172, 127.0573]], count: 28 },
                { id: 'lee', name: 'ì´ê¸°ì‚¬', position: [37.5563, 126.9239], zone: 'ë§ˆí¬ê¶Œ', color: '#667eea', status: 'busy', bounds: [[37.5463, 126.9139], [37.5663, 126.9439]], count: 32 },
                { id: 'park', name: 'ë°•ê¸°ì‚¬', position: [37.5133, 127.1028], zone: 'ì†¡íŒŒê¶Œ', color: '#ffa502', status: 'active', bounds: [[37.5033, 127.0928], [37.5233, 127.1228]], count: 25 },
                { id: 'choi', name: 'ìµœê¸°ì‚¬', position: [37.5701, 126.9916], zone: 'ì¢…ë¡œê¶Œ', color: '#ff4757', status: 'break', bounds: [[37.5601, 126.9816], [37.5801, 127.0116]], count: 31 },
                { id: 'jung', name: 'ì •ê¸°ì‚¬', position: [37.4795, 126.9520], zone: 'ì„œì´ˆê¶Œ', color: '#a55eea', status: 'active', bounds: [[37.4695, 126.9420], [37.4895, 126.9720]], count: 29 },
                { id: 'kang', name: 'ê°•ê¸°ì‚¬', position: [37.5388, 126.8903], zone: 'ì˜ë“±í¬ê¶Œ', color: '#26d0ce', status: 'active', bounds: [[37.5288, 126.8803], [37.5488, 127.0003]], count: 27 },
                { id: 'han', name: 'í•œê¸°ì‚¬', position: [37.6068, 126.9689], zone: 'ì„±ë¶ê¶Œ', color: '#fd79a8', status: 'busy', bounds: [[37.5968, 126.9589], [37.6168, 126.9889]], count: 26 },
                { id: 'oh', name: 'ì˜¤ê¸°ì‚¬', position: [37.4979, 126.8644], zone: 'ê´€ì•…ê¶Œ', color: '#fdcb6e', status: 'active', bounds: [[37.4879, 126.8544], [37.5079, 126.8844]], count: 30 },
                { id: 'shin', name: 'ì‹ ê¸°ì‚¬', position: [37.5510, 126.8488], zone: 'êµ¬ë¡œê¶Œ', color: '#6c5ce7', status: 'active', bounds: [[37.5410, 126.8388], [37.5610, 126.8688]], count: 24 },
                { id: 'lim', name: 'ì„ê¸°ì‚¬', position: [37.5662, 126.8011], zone: 'ê°•ì„œê¶Œ', color: '#00b894', status: 'break', bounds: [[37.5562, 126.7911], [37.5762, 126.8211]], count: 33 },
                { id: 'yoon', name: 'ìœ¤ê¸°ì‚¬', position: [37.6583, 127.0617], zone: 'ë…¸ì›ê¶Œ', color: '#e17055', status: 'active', bounds: [[37.6483, 127.0517], [37.6683, 127.0817]], count: 28 },
                { id: 'song', name: 'ì†¡ê¸°ì‚¬', position: [37.6176, 127.0582], zone: 'ì¤‘ë‘ê¶Œ', color: '#00cec9', status: 'busy', bounds: [[37.6076, 127.0482], [37.6276, 127.0782]], count: 25 },
                { id: 'moon', name: 'ë¬¸ê¸°ì‚¬', position: [37.5944, 127.1294], zone: 'ê´‘ì§„ê¶Œ', color: '#dda0dd', status: 'active', bounds: [[37.5844, 127.1194], [37.6044, 127.1494]], count: 27 },
                { id: 'baek', name: 'ë°±ê¸°ì‚¬', position: [37.5239, 126.8597], zone: 'ì–‘ì²œê¶Œ', color: '#fab1a0', status: 'active', bounds: [[37.5139, 126.8497], [37.5339, 126.8797]], count: 31 },
                { id: 'nam', name: 'ë‚¨ê¸°ì‚¬', position: [37.4678, 127.0373], zone: 'ì„œì´ˆë‚¨ë¶€', color: '#e84393', status: 'active', bounds: [[37.4578, 127.0273], [37.4778, 127.0573]], count: 26 },
                { id: 'go', name: 'ê³ ê¸°ì‚¬', position: [37.3914, 127.1197], zone: 'ë¶„ë‹¹ê¶Œ', color: '#0984e3', status: 'active', bounds: [[37.3814, 127.1097], [37.4014, 127.1397]], count: 35 },
                { id: 'hong', name: 'í™ê¸°ì‚¬', position: [37.2636, 127.0286], zone: 'ìˆ˜ì›ê¶Œ', color: '#00b894', status: 'busy', bounds: [[37.2536, 127.0186], [37.2836, 127.0486]], count: 38 },
                { id: 'woo', name: 'ìš°ê¸°ì‚¬', position: [37.6583, 126.7747], zone: 'ì¼ì‚°ê¶Œ', color: '#fd79a8', status: 'active', bounds: [[37.6483, 126.7647], [37.6783, 126.7947]], count: 32 },
                { id: 'ahn', name: 'ì•ˆê¸°ì‚¬', position: [37.4563, 126.7052], zone: 'ë¶€ì²œê¶Œ', color: '#fdcb6e', status: 'active', bounds: [[37.4463, 126.6952], [37.4663, 126.7252]], count: 29 },
                { id: 'jang', name: 'ì¥ê¸°ì‚¬', position: [37.6398, 127.2578], zone: 'êµ¬ë¦¬ê¶Œ', color: '#a29bfe', status: 'break', bounds: [[37.6298, 127.2478], [37.6498, 127.2778]], count: 24 }
            ];

            driverConfigs.forEach(config => {
                driversData[config.id] = {
                    name: config.name,
                    position: config.position,
                    color: config.color,
                    zone: config.zone,
                    status: config.status,
                    deliveries: generateDeliveries(config.id, config.bounds[0], config.bounds[1], config.count)
                };
            });
        }

        // ë°°ì†¡ì§€ ìƒì„± í•¨ìˆ˜
        function generateDeliveries(driverId, minCoord, maxCoord, count) {
            const deliveries = [];
            const statuses = ['delivered', 'transit', 'pending', 'delayed'];
            const statusWeights = [0.6, 0.15, 0.2, 0.05]; // ì™„ë£Œ 60%, ë°°ì†¡ì¤‘ 15%, ëŒ€ê¸° 20%, ì§€ì—° 5%
            
            for (let i = 0; i < count; i++) {
                // ê°€ì¤‘ì¹˜ ê¸°ë°˜ ìƒíƒœ ì„ íƒ
                const random = Math.random();
                let status = 'pending';
                let cumulative = 0;
                for (let j = 0; j < statusWeights.length; j++) {
                    cumulative += statusWeights[j];
                    if (random <= cumulative) {
                        status = statuses[j];
                        break;
                    }
                }

                // ê¶Œì—­ ë‚´ ëœë¤ ìœ„ì¹˜ ìƒì„±
                const lat = minCoord[0] + Math.random() * (maxCoord[0] - minCoord[0]);
                const lng = minCoord[1] + Math.random() * (maxCoord[1] - minCoord[1]);
                
                // ì§€ì—­ë³„ ì£¼ì†Œ ìƒì„±
                const addresses = {
                    kim: ['ê°•ë‚¨êµ¬ í…Œí—¤ë€ë¡œ', 'ê°•ë‚¨êµ¬ ì—­ì‚¼ë™', 'ê°•ë‚¨êµ¬ ì‚¼ì„±ë™', 'ê°•ë‚¨êµ¬ ëŒ€ì¹˜ë™', 'ê°•ë‚¨êµ¬ ì²­ë‹´ë™'],
                    lee: ['ë§ˆí¬êµ¬ í™ëŒ€ì…êµ¬', 'ë§ˆí¬êµ¬ ì„œêµë™', 'ë§ˆí¬êµ¬ ì—°ë‚¨ë™', 'ë§ˆí¬êµ¬ í•©ì •ë™', 'ë§ˆí¬êµ¬ ìƒìˆ˜ë™'],
                    park: ['ì†¡íŒŒêµ¬ ì ì‹¤ë™', 'ì†¡íŒŒêµ¬ ì‹ ì²œë™', 'ì†¡íŒŒêµ¬ ì‚¼ì „ë™', 'ì†¡íŒŒêµ¬ ì„ì´Œë™', 'ì†¡íŒŒêµ¬ ì†¡íŒŒë™'],
                    choi: ['ì¢…ë¡œêµ¬ ì¢…ë¡œ3ê°€', 'ì¢…ë¡œêµ¬ ì¸ì‚¬ë™', 'ì¢…ë¡œêµ¬ í˜œí™”ë™', 'ì¢…ë¡œêµ¬ ì‚¼ì²­ë™', 'ì¢…ë¡œêµ¬ ì•ˆêµ­ë™'],
                    jung: ['ì„œì´ˆêµ¬ ì„œì´ˆë™', 'ì„œì´ˆêµ¬ ë°©ë°°ë™', 'ì„œì´ˆêµ¬ ì–‘ì¬ë™', 'ì„œì´ˆêµ¬ ë°˜í¬ë™', 'ì„œì´ˆêµ¬ ë‚´ê³¡ë™'],
                    kang: ['ì˜ë“±í¬êµ¬ ì—¬ì˜ë„', 'ì˜ë“±í¬êµ¬ ë‹¹ì‚°ë™', 'ì˜ë“±í¬êµ¬ ë¬¸ë˜ë™', 'ì˜ë“±í¬êµ¬ ì‹ ê¸¸ë™', 'ì˜ë“±í¬êµ¬ ëŒ€ë¦¼ë™'],
                    han: ['ì„±ë¶êµ¬ ì„±ë¶ë™', 'ì„±ë¶êµ¬ ëˆì•”ë™', 'ì„±ë¶êµ¬ ì •ë¦‰ë™', 'ì„±ë¶êµ¬ ì¥ìœ„ë™', 'ì„±ë¶êµ¬ ì„ê´€ë™'],
                    oh: ['ê´€ì•…êµ¬ ì‹ ë¦¼ë™', 'ê´€ì•…êµ¬ ë´‰ì²œë™', 'ê´€ì•…êµ¬ ë‚¨í˜„ë™', 'ê´€ì•…êµ¬ ì¤‘ì•™ë™', 'ê´€ì•…êµ¬ ì¸í—Œë™'],
                    shin: ['êµ¬ë¡œêµ¬ ì‹ ë„ë¦¼', 'êµ¬ë¡œêµ¬ êµ¬ë¡œë™', 'êµ¬ë¡œêµ¬ ê°€ë¦¬ë´‰', 'êµ¬ë¡œêµ¬ ê°œë´‰ë™', 'êµ¬ë¡œêµ¬ ì˜¤ë¥˜ë™'],
                    lim: ['ê°•ì„œêµ¬ í™”ê³¡ë™', 'ê°•ì„œêµ¬ ë“±ì´Œë™', 'ê°•ì„œêµ¬ ì—¼ì°½ë™', 'ê°•ì„œêµ¬ ë°œì‚°ë™', 'ê°•ì„œêµ¬ ê³µí•­ë™'],
                    yoon: ['ë…¸ì›êµ¬ ìƒê³„ë™', 'ë…¸ì›êµ¬ ì¤‘ê³„ë™', 'ë…¸ì›êµ¬ í•˜ê³„ë™', 'ë…¸ì›êµ¬ ê³µë¦‰ë™', 'ë…¸ì›êµ¬ ì›”ê³„ë™'],
                    song: ['ì¤‘ë‘êµ¬ ë©´ëª©ë™', 'ì¤‘ë‘êµ¬ ìƒë´‰ë™', 'ì¤‘ë‘êµ¬ ì¤‘í™”ë™', 'ì¤‘ë‘êµ¬ ë¬µë™', 'ì¤‘ë‘êµ¬ ë§ìš°ë™'],
                    moon: ['ê´‘ì§„êµ¬ ìì–‘ë™', 'ê´‘ì§„êµ¬ êµ¬ì˜ë™', 'ê´‘ì§„êµ¬ ì¤‘ê³¡ë™', 'ê´‘ì§„êµ¬ ëŠ¥ë™', 'ê´‘ì§„êµ¬ í™”ì–‘ë™'],
                    baek: ['ì–‘ì²œêµ¬ ëª©ë™', 'ì–‘ì²œêµ¬ ì‹ ì •ë™', 'ì–‘ì²œêµ¬ ì‹ ì›”ë™', 'ì–‘ì²œêµ¬ í™”ê³¡ë™', 'ì–‘ì²œêµ¬ ë“±ì´Œë™'],
                    nam: ['ì„œì´ˆêµ¬ ì ì›ë™', 'ì„œì´ˆêµ¬ ë°˜í¬ë™', 'ì„œì´ˆêµ¬ ì„œì´ˆë™', 'ì„œì´ˆêµ¬ ë°©ë°°ë™', 'ì„œì´ˆêµ¬ ì–‘ì¬ë™'],
                    go: ['ì„±ë‚¨ì‹œ ë¶„ë‹¹êµ¬', 'ì„±ë‚¨ì‹œ ìˆ˜ì •êµ¬', 'ì„±ë‚¨ì‹œ ì¤‘ì›êµ¬', 'ë¶„ë‹¹êµ¬ ì •ìë™', 'ë¶„ë‹¹êµ¬ ì„œí˜„ë™'],
                    hong: ['ìˆ˜ì›ì‹œ ì˜í†µêµ¬', 'ìˆ˜ì›ì‹œ ì¥ì•ˆêµ¬', 'ìˆ˜ì›ì‹œ ê¶Œì„ êµ¬', 'ìˆ˜ì›ì‹œ íŒ”ë‹¬êµ¬', 'ìˆ˜ì›ì‹œ ì—°ë¬´ë™'],
                    woo: ['ê³ ì–‘ì‹œ ì¼ì‚°êµ¬', 'ê³ ì–‘ì‹œ ë•ì–‘êµ¬', 'ì¼ì‚°ë™êµ¬', 'ì¼ì‚°ì„œêµ¬', 'ê³ ì–‘ì‹œ í™”ì •ë™'],
                    ahn: ['ë¶€ì²œì‹œ ì›ë¯¸êµ¬', 'ë¶€ì²œì‹œ ì†Œì‚¬êµ¬', 'ë¶€ì²œì‹œ ì˜¤ì •êµ¬', 'ë¶€ì²œì‹œ ì¤‘ë™', 'ë¶€ì²œì‹œ ìƒë™'],
                    jang: ['êµ¬ë¦¬ì‹œ ìˆ˜íƒë™', 'êµ¬ë¦¬ì‹œ ì¸ì°½ë™', 'êµ¬ë¦¬ì‹œ êµë¬¸ë™', 'êµ¬ë¦¬ì‹œ í† í‰ë™', 'êµ¬ë¦¬ì‹œ ê°ˆë§¤ë™']
                };
                
                const addressList = addresses[driverId] || ['ì„œìš¸ì‹œ ì¤‘êµ¬'];
                const randomAddress = addressList[Math.floor(Math.random() * addressList.length)];
                const buildingNumber = Math.floor(Math.random() * 999) + 1;

                deliveries.push({
                    id: `QS2024-${String(10000 + i + (Object.keys(driversData).indexOf(driverId) * 100)).padStart(6, '0')}`,
                    position: [lat, lng],
                    address: `${randomAddress} ${buildingNumber}`,
                    status: status,
                    priority: Math.random() > 0.8 ? 'high' : 'normal',
                    completedAt: status === 'delivered' ? generateRandomTime() : null,
                    estimatedTime: status !== 'delivered' ? generateEstimatedTime() : null
                });
            }
            
            return deliveries.sort((a, b) => {
                const statusOrder = { 'transit': 0, 'delayed': 1, 'pending': 2, 'delivered': 3 };
                return statusOrder[a.status] - statusOrder[b.status];
            });
        }

        // ëœë¤ ì™„ë£Œ ì‹œê°„ ìƒì„±
        function generateRandomTime() {
            const hours = Math.floor(Math.random() * 8) + 9; // 9-17ì‹œ
            const minutes = Math.floor(Math.random() * 60);
            return `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}`;
        }

        // ì˜ˆìƒ ë„ì°© ì‹œê°„ ìƒì„±
        function generateEstimatedTime() {
            const hours = Math.floor(Math.random() * 4) + 14; // 14-17ì‹œ
            const minutes = Math.floor(Math.random() * 60);
            return `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}`;
        }

        // ì§€ë„ ì´ˆê¸°í™”
        function initializeMap() {
            // ê¸°ì‚¬ ë°ì´í„° ë¨¼ì € ì´ˆê¸°í™”
            initializeDriversData();
            
            map = L.map('map').setView([37.5665, 126.9780], 10);

            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: 'Â© OpenStreetMap contributors'
            }).addTo(map);

            // ê¸°ì‚¬ ì¹© ìƒì„±
            createDriverChips();
            
            // ì´ˆê¸° ë°°ì†¡ ëª©ë¡ ìƒì„±
            createInitialDeliveryList();
            
            showAllDrivers();
        }

        // ê¸°ì‚¬ ì¹© ìƒì„±
        function createDriverChips() {
            const chipContainer = document.getElementById('driverChips');
            let chipsHTML = `
                <div class="driver-chip selected" onclick="toggleDriver('all', this)">
                    <span class="driver-status status-active"></span>
                    ì „ì²´ (20ëª…)
                </div>
            `;
            
            Object.entries(driversData).forEach(([id, driver]) => {
                chipsHTML += `
                    <div class="driver-chip" onclick="toggleDriver('${id}', this)">
                        <span class="driver-status status-${driver.status}"></span>
                        ${driver.name}
                    </div>
                `;
            });
            
            chipContainer.innerHTML = chipsHTML;
        }

        // ì´ˆê¸° ë°°ì†¡ ëª©ë¡ ìƒì„±
        function createInitialDeliveryList() {
            const deliveryList = document.getElementById('deliveryList');
            const allDeliveries = [];
            
            // ëª¨ë“  ê¸°ì‚¬ì˜ ì§„í–‰ì¤‘ì¸ ë°°ì†¡ë§Œ ìˆ˜ì§‘
            Object.values(driversData).forEach(driver => {
                const activeDeliveries = driver.deliveries
                    .filter(d => d.status !== 'delivered')
                    .slice(0, 3) // ê¸°ì‚¬ë‹¹ ìµœëŒ€ 3ê°œë§Œ
                    .map(d => ({ ...d, driverName: driver.name }));
                allDeliveries.push(...activeDeliveries);
            });
            
            // ìš°ì„ ìˆœìœ„ì™€ ìƒíƒœìˆœìœ¼ë¡œ ì •ë ¬
            allDeliveries.sort((a, b) => {
                const priorityOrder = { 'high': 0, 'normal': 1 };
                const statusOrder = { 'delayed': 0, 'transit': 1, 'pending': 2 };
                
                if (a.priority !== b.priority) {
                    return priorityOrder[a.priority] - priorityOrder[b.priority];
                }
                return statusOrder[a.status] - statusOrder[b.status];
            });
            
            const deliveriesHTML = allDeliveries.slice(0, 20).map(delivery => `
                <div class="delivery-item" data-status="${delivery.status}" data-priority="${delivery.priority}" 
                     onclick="trackDelivery('${delivery.id}')">
                    <div class="delivery-header">
                        <span class="delivery-id">${delivery.id}</span>
                        <span class="status-badge status-${delivery.status}">
                            ${delivery.status === 'transit' ? 'ë°°ì†¡ì¤‘' :
                              delivery.status === 'pending' ? 'ëŒ€ê¸°' :
                              delivery.status === 'delayed' ? 'ì§€ì—°' : 'ì™„ë£Œ'}
                        </span>
                    </div>
                    <div class="delivery-address">${delivery.address}</div>
                    <div class="delivery-meta">
                        <span class="priority-${delivery.priority}">
                            ${delivery.priority === 'high' ? 'ê¸´ê¸‰' : 'ì¼ë°˜'}
                        </span>
                        <span>${delivery.driverName} â€¢ ${delivery.estimatedTime || 'ì‹œê°„ë¯¸ì •'}</span>
                    </div>
                </div>
            `).join('');
            
            deliveryList.innerHTML = deliveriesHTML;
        }

        // ì‚¬ì´ë“œë°” í† ê¸€
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const toggleIcon = document.getElementById('toggleIcon');
            
            sidebarCollapsed = !sidebarCollapsed;
            
            if (sidebarCollapsed) {
                sidebar.classList.add('collapsed');
                toggleIcon.textContent = 'â†’';
            } else {
                sidebar.classList.remove('collapsed');
                toggleIcon.textContent = 'â†';
            }
            
            setTimeout(() => {
                map.invalidateSize();
            }, 300);
        }

        // ëª¨ë“  ê¸°ì‚¬ í‘œì‹œ
        function showAllDrivers() {
            Object.keys(driversData).forEach(driverId => {
                showDriver(driverId);
            });
        }

        // ê°œë³„ ê¸°ì‚¬ í‘œì‹œ (ìš”ì•½ ëª¨ë“œ)
        function showDriver(driverId) {
            const driver = driversData[driverId];
            
            // ê¸°ì‚¬ ìœ„ì¹˜ ë§ˆì»¤
            const driverIcon = L.divIcon({
                className: 'custom-driver-marker',
                html: `<div style="
                    background: ${driver.color};
                    width: 32px;
                    height: 32px;
                    border-radius: 50%;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    color: white;
                    font-weight: bold;
                    font-size: 14px;
                    border: 3px solid white;
                    box-shadow: 0 3px 15px rgba(0,0,0,0.4);
                    cursor: pointer;
                    ${driver.status === 'active' ? 'animation: pulse-driver 3s infinite;' : ''}
                ">ğŸšš</div>
                <style>
                    @keyframes pulse-driver {
                        0%, 100% { transform: scale(1); }
                        50% { transform: scale(1.05); }
                    }
                </style>`,
                iconSize: [38, 38],
                iconAnchor: [19, 19]
            });

            const completedCount = driver.deliveries.filter(d => d.status === 'delivered').length;
            const progressPercent = Math.round((completedCount / driver.deliveries.length) * 100);

            driverMarkers[driverId] = L.marker(driver.position, { icon: driverIcon })
                .addTo(map)
                .bindPopup(`
                    <div style="color: #333; font-weight: bold; margin-bottom: 8px; font-size: 14px;">
                        ${driver.name} (${driver.zone})
                    </div>
                    <div style="color: #666; font-size: 12px; margin-bottom: 8px;">
                        ì§„í–‰ë¥ : ${progressPercent}% (${completedCount}/${driver.deliveries.length})<br>
                        ìƒíƒœ: ${driver.status === 'active' ? 'ìš´í–‰ì¤‘' : 
                                driver.status === 'busy' ? 'ë°”ì¨' : 'íœ´ì‹ì¤‘'}
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 4px; font-size: 11px; margin-bottom: 8px;">
                        <div style="color: #2ed573;">âœ“ ${driver.deliveries.filter(d => d.status === 'delivered').length}ê±´</div>
                        <div style="color: #667eea;">ğŸšš ${driver.deliveries.filter(d => d.status === 'transit').length}ê±´</div>
                        <div style="color: #ffa502;">â³ ${driver.deliveries.filter(d => d.status === 'pending').length}ê±´</div>
                        <div style="color: #ff4757;">âš ï¸ ${driver.deliveries.filter(d => d.status === 'delayed').length}ê±´</div>
                    </div>
                    <div style="text-align: center;">
                        <button onclick="showDriverDetail('${driverId}')" 
                                style="background: ${driver.color}; color: white; border: none; 
                                       padding: 6px 12px; border-radius: 4px; cursor: pointer; 
                                       font-size: 12px; font-weight: bold;">
                            ìƒì„¸ ê´€ì œ (${driver.deliveries.length}ê±´)
                        </button>
                    </div>
                `)
                .on('click', function() {
                    showDriverDetail(driverId);
                });

            // ìš”ì•½ ë°°ì†¡ì§€ ë§ˆì»¤ë“¤ (ì£¼ìš” ëª‡ ê°œë§Œ)
            const summaryDeliveries = driver.deliveries
                .filter(d => d.status !== 'delivered')
                .slice(0, 3);
                
            summaryDeliveries.forEach(delivery => {
                const statusColor = {
                    'pending': '#ffa502',
                    'transit': '#667eea',
                    'delivered': '#888888',
                    'delayed': '#ff4757'
                }[delivery.status];

                const deliveryIcon = L.divIcon({
                    className: 'custom-delivery-marker',
                    html: `<div style="
                        background: ${statusColor};
                        width: 14px;
                        height: 14px;
                        border-radius: 50%;
                        border: 2px solid white;
                        box-shadow: 0 2px 8px rgba(0,0,0,0.2);
                        opacity: 0.8;
                    "></div>`,
                    iconSize: [18, 18],
                    iconAnchor: [9, 9]
                });

                const marker = L.marker(delivery.position, { icon: deliveryIcon })
                    .addTo(map)
                    .bindPopup(`
                        <div style="color: #333; font-size: 11px; margin-bottom: 2px;">${delivery.id}</div>
                        <div style="color: #666; font-size: 10px;">${delivery.address}</div>
                    `);

                if (!deliveryMarkers[driverId]) deliveryMarkers[driverId] = [];
                deliveryMarkers[driverId].push(marker);
            });

            // ê¸°ë³¸ ê²½ë¡œ í‘œì‹œ (ì£¼ìš” ë°°ì†¡ì§€ë“¤ë§Œ)
            if (summaryDeliveries.length > 0) {
                calculateBasicRoute(driverId, summaryDeliveries);
            }
        }

        // ê¸°ë³¸ ê²½ë¡œ ê³„ì‚° (ìš”ì•½ ëª¨ë“œ)
        function calculateBasicRoute(driverId, deliveries) {
            const driver = driversData[driverId];
            const coordinates = [driver.position, ...deliveries.map(d => d.position)];
            
            const routeLine = L.polyline(coordinates, {
                color: driver.color,
                weight: 2,
                opacity: 0.6,
                dashArray: '8, 12'
            }).addTo(map);
            
            if (!routeLines[driverId]) routeLines[driverId] = [];
            routeLines[driverId].push(routeLine);
        }

        // ê¸°ì‚¬ë³„ ìƒì„¸ ê´€ì œ ëª¨ë“œ
        function showDriverDetail(driverId) {
            const driver = driversData[driverId];
            currentDetailDriver = driverId;
            
            // ë‹¤ë¥¸ ê¸°ì‚¬ë“¤ ìˆ¨ê¸°ê¸°
            Object.keys(driversData).forEach(id => {
                if (id !== driverId) {
                    hideDriver(id);
                }
            });

            // í•´ë‹¹ ê¸°ì‚¬ì˜ ëª¨ë“  ë°°ì†¡ì§€ í‘œì‹œ
            showAllDriverDeliveries(driverId);
            
            // ì§€ë„ ì¤‘ì‹¬ì„ í•´ë‹¹ ê¸°ì‚¬ ê¶Œì—­ìœ¼ë¡œ ì´ë™
            const bounds = L.latLngBounds([driver.position]);
            driver.deliveries.forEach(delivery => bounds.extend(delivery.position));
            map.fitBounds(bounds, { padding: [50, 50] });
            
            // ì‚¬ì´ë“œë°” ì—…ë°ì´íŠ¸
            updateDriverDetailSidebar(driverId);
            
            // ì•Œë¦¼ í‘œì‹œ
            const alertPanel = document.getElementById('alertPanel');
            alertPanel.className = 'alert-panel info';
            alertPanel.innerHTML = `
                <button class="alert-close" onclick="exitDetailMode()">Ã—</button>
                <div class="alert-title">ğŸ¯ ${driver.name} ìƒì„¸ ê´€ì œ ëª¨ë“œ</div>
                <div class="alert-content">
                    ${driver.zone} ì „ì²´ ${driver.deliveries.length}ê±´ í‘œì‹œ ì¤‘<br>
                    <strong>íšŒìƒ‰:</strong> ì™„ë£Œ â€¢ <strong>ë…¹ìƒ‰:</strong> ì§„í–‰ì¤‘ â€¢ <strong>ì£¼í™©:</strong> ëŒ€ê¸° â€¢ <strong>ë¹¨ê°•:</strong> ì§€ì—°
                </div>
            `;
            alertPanel.style.display = 'block';
        }

        // ê¸°ì‚¬ì˜ ëª¨ë“  ë°°ì†¡ì§€ í‘œì‹œ
        function showAllDriverDeliveries(driverId) {
            const driver = driversData[driverId];
            
            // ê¸°ì¡´ ë§ˆì»¤ë“¤ ì œê±°
            if (deliveryMarkers[driverId]) {
                deliveryMarkers[driverId].forEach(marker => map.removeLayer(marker));
            }
            if (routeLines[driverId]) {
                routeLines[driverId].forEach(line => map.removeLayer(line));
            }
            deliveryMarkers[driverId] = [];
            routeLines[driverId] = [];

            // ëª¨ë“  ë°°ì†¡ì§€ ë§ˆì»¤ ìƒì„±
            driver.deliveries.forEach((delivery, index) => {
                const statusColors = {
                    'delivered': '#555555',    // ë” ì§„í•œ íšŒìƒ‰ (ì™„ë£Œ)
                    'transit': '#2ed573',      // ë…¹ìƒ‰ (ì§„í–‰ì¤‘)
                    'pending': '#ffa502',      // ì£¼í™© (ëŒ€ê¸°)
                    'delayed': '#ff4757'       // ë¹¨ê°• (ì§€ì—°)
                };

                const statusColor = statusColors[delivery.status];
                const isCompleted = delivery.status === 'delivered';
                
                // ì™„ë£Œê±´ê³¼ ë¯¸ì™„ë£Œê±´ êµ¬ë¶„í•˜ì—¬ ìŠ¤íƒ€ì¼ ì ìš©
                const deliveryIcon = L.divIcon({
                    className: 'custom-delivery-marker-detail',
                    html: `<div style="
                        background: ${statusColor};
                        width: ${isCompleted ? '20px' : '22px'};
                        height: ${isCompleted ? '20px' : '22px'};
                        border-radius: 50%;
                        border: 2px solid white;
                        box-shadow: 0 3px 12px rgba(0,0,0,0.4);
                        opacity: ${isCompleted ? '0.9' : '1'};
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        color: white;
                        font-size: 10px;
                        font-weight: bold;
                        cursor: pointer;
                        ${delivery.status === 'delayed' ? 'animation: blink 1.5s infinite;' : ''}
                        ${delivery.status === 'transit' ? 'animation: pulse-green 2s infinite;' : ''}
                        ${isCompleted ? 'border: 3px solid #333;' : ''}
                    ">${isCompleted ? 'âœ“' : (index + 1)}</div>
                    <style>
                        @keyframes blink {
                            0%, 50% { opacity: 1; }
                            51%, 100% { opacity: 0.4; }
                        }
                        @keyframes pulse-green {
                            0%, 100% { transform: scale(1); }
                            50% { transform: scale(1.15); box-shadow: 0 3px 20px rgba(46, 213, 115, 0.6); }
                        }
                    </style>`,
                    iconSize: [26, 26],
                    iconAnchor: [13, 13]
                });

                const statusText = {
                    'delivered': 'ë°°ì†¡ì™„ë£Œ',
                    'transit': 'ë°°ì†¡ì¤‘',
                    'pending': 'í”½ì—…ëŒ€ê¸°',
                    'delayed': 'ì§€ì—°'
                }[delivery.status];

                const marker = L.marker(delivery.position, { icon: deliveryIcon })
                    .addTo(map)
                    .bindPopup(`
                        <div style="color: #333; font-weight: bold; margin-bottom: 6px; font-size: 13px;">
                            ${delivery.id}
                        </div>
                        <div style="color: #666; font-size: 11px; margin-bottom: 4px;">
                            ${delivery.address}
                        </div>
                        <div style="color: ${statusColor}; font-size: 11px; font-weight: bold; margin-bottom: 4px;">
                            ${statusText} ${delivery.priority === 'high' ? '(ê¸´ê¸‰)' : ''}
                        </div>
                        ${delivery.completedAt ? `<div style="color: #888; font-size: 10px;">ì™„ë£Œ: ${delivery.completedAt}</div>` : ''}
                        ${delivery.estimatedTime ? `<div style="color: #666; font-size: 10px;">ì˜ˆìƒ: ${delivery.estimatedTime}</div>` : ''}
                        <div style="margin-top: 6px; font-size: 10px; color: #999;">
                            ìˆœì„œ: ${index + 1}/${driver.deliveries.length}
                        </div>
                    `);

                deliveryMarkers[driverId].push(marker);
            });

            // ìƒì„¸ ê²½ë¡œ ê³„ì‚° ë° í‘œì‹œ
            calculateDetailedRoute(driverId);
        }

        // ìƒì„¸ ê²½ë¡œ ê³„ì‚°
        async function calculateDetailedRoute(driverId) {
            const driver = driversData[driverId];
            const pendingDeliveries = driver.deliveries.filter(d => d.status !== 'delivered');
            const completedDeliveries = driver.deliveries.filter(d => d.status === 'delivered');

            // ì™„ë£Œëœ ë°°ì†¡ì§€ë“¤ ê²½ë¡œ (ì§„í•œ íšŒìƒ‰ ì‹¤ì„ ìœ¼ë¡œ ê°€ì‹œì„± ê°œì„ )
            if (completedDeliveries.length > 1) {
                const completedCoordinates = completedDeliveries.map(d => d.position);
                const completedRoute = L.polyline(completedCoordinates, {
                    color: '#666666',        // ë” ì§„í•œ íšŒìƒ‰ìœ¼ë¡œ ë³€ê²½
                    weight: 3,               // ë‘ê»˜ ì¦ê°€
                    opacity: 0.85,           // íˆ¬ëª…ë„ ì¦ê°€
                    dashArray: '8, 6'        // ì ì„  íŒ¨í„´ ê°œì„ 
                }).addTo(map);
                
                completedRoute.bindPopup(`
                    <div style="font-weight: bold; color: #333;">${driver.name} - ì™„ë£Œëœ ê²½ë¡œ</div>
                    <div style="color: #666; font-size: 12px;">ì™„ë£Œ ê±´ìˆ˜: ${completedDeliveries.length}ê±´</div>
                    <div style="color: #888; font-size: 11px;">ì´ ì´ë™ê±°ë¦¬: ì•½ ${(completedDeliveries.length * 2.3).toFixed(1)}km</div>
                `);
                
                routeLines[driverId].push(completedRoute);
            }

            // ì§„í–‰ ì˜ˆì • ê²½ë¡œ
            if (pendingDeliveries.length > 0) {
                const remainingCoordinates = [driver.position, ...pendingDeliveries.map(d => d.position)];
                
                try {
                    const coordString = remainingCoordinates.map(coord => `${coord[1]},${coord[0]}`).join(';');
                    const response = await fetch(`https://router.project-osrm.org/route/v1/driving/${coordString}?overview=full&geometries=geojson`);
                    const data = await response.json();
                    
                    if (data.routes && data.routes[0]) {
                        const routeCoordinates = data.routes[0].geometry.coordinates.map(coord => [coord[1], coord[0]]);
                        
                        const activeRoute = L.polyline(routeCoordinates, {
                            color: driver.color,
                            weight: 4,
                            opacity: 0.8,
                            dashArray: '10, 5'
                        }).addTo(map);
                        
                        const distance = (data.routes[0].distance / 1000).toFixed(1);
                        const duration = Math.round(data.routes[0].duration / 60);
                        
                        activeRoute.bindPopup(`
                            <div style="font-weight: bold;">${driver.name} - ë‚¨ì€ ê²½ë¡œ</div>
                            <div>ê±°ë¦¬: ${distance}km â€¢ ì‹œê°„: ${duration}ë¶„</div>
                            <div>ë‚¨ì€ ë°°ì†¡: ${pendingDeliveries.length}ê±´</div>
                            <div style="margin-top: 4px; font-size: 11px; color: #666;">
                                OSRM ìµœì í™” ê²½ë¡œ
                            </div>
                        `);
                        
                        routeLines[driverId].push(activeRoute);
                    }
                } catch (error) {
                    // ì‹¤íŒ¨ ì‹œ ì§ì„  ê²½ë¡œ
                    const fallbackRoute = L.polyline(remainingCoordinates, {
                        color: driver.color,
                        weight: 3,
                        opacity: 0.6,
                        dashArray: '8, 12'
                    }).addTo(map);
                    
                    fallbackRoute.bindPopup(`
                        <div style="font-weight: bold;">${driver.name} - ë‚¨ì€ ê²½ë¡œ</div>
                        <div>ë‚¨ì€ ë°°ì†¡: ${pendingDeliveries.length}ê±´</div>
                        <div style="font-size: 11px; color: #999;">ì§ì„  ê²½ë¡œ (ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜)</div>
                    `);
                    
                    routeLines[driverId].push(fallbackRoute);
                }
            }
        }

        // ê¸°ì‚¬ ìˆ¨ê¸°ê¸°
        function hideDriver(driverId) {
            if (driverMarkers[driverId]) {
                map.removeLayer(driverMarkers[driverId]);
                delete driverMarkers[driverId];
            }
            
            if (deliveryMarkers[driverId]) {
                deliveryMarkers[driverId].forEach(marker => map.removeLayer(marker));
                delete deliveryMarkers[driverId];
            }
            
            if (routeLines[driverId]) {
                routeLines[driverId].forEach(line => map.removeLayer(line));
                delete routeLines[driverId];
            }
        }

        // ì‚¬ì´ë“œë°” ìƒì„¸ ì •ë³´ ì—…ë°ì´íŠ¸
        function updateDriverDetailSidebar(driverId) {
            const driver = driversData[driverId];
            const deliverySection = document.getElementById('deliveryList');
            
            const completedCount = driver.deliveries.filter(d => d.status === 'delivered').length;
            const transitCount = driver.deliveries.filter(d => d.status === 'transit').length;
            const pendingCount = driver.deliveries.filter(d => d.status === 'pending').length;
            const delayedCount = driver.deliveries.filter(d => d.status === 'delayed').length;
            
            deliverySection.innerHTML = `
                <div style="background: rgba(${
                    driver.color === '#2ed573' ? '46, 213, 115' : 
                    driver.color === '#667eea' ? '102, 126, 234' : 
                    driver.color === '#ffa502' ? '255, 165, 2' : 
                    driver.color === '#ff4757' ? '255, 71, 87' :
                    driver.color === '#a55eea' ? '165, 94, 234' :
                    driver.color === '#26d0ce' ? '38, 208, 206' :
                    driver.color === '#fd79a8' ? '253, 121, 168' :
                    driver.color === '#fdcb6e' ? '253, 203, 110' :
                    driver.color === '#6c5ce7' ? '108, 92, 231' :
                    driver.color === '#00b894' ? '0, 184, 148' :
                    driver.color === '#e17055' ? '225, 112, 85' :
                    driver.color === '#00cec9' ? '0, 206, 201' :
                    driver.color === '#dda0dd' ? '221, 160, 221' :
                    driver.color === '#fab1a0' ? '250, 177, 160' :
                    driver.color === '#e84393' ? '232, 67, 147' :
                    driver.color === '#0984e3' ? '9, 132, 227' :
                    driver.color === '#a29bfe' ? '162, 155, 254' : '102, 126, 234'
                }, 0.1); 
                        border: 1px solid ${driver.color}; 
                        border-radius: 8px; 
                        padding: 1rem; 
                        margin-bottom: 1rem;">
                    <div style="font-weight: bold; font-size: 1rem; color: ${driver.color}; margin-bottom: 0.5rem;">
                        ${driver.name} ìƒì„¸ í˜„í™© (${driver.zone})
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; font-size: 0.8rem; margin-bottom: 0.5rem;">
                        <div style="color: #2ed573;">âœ“ ì™„ë£Œ: ${completedCount}ê±´</div>
                        <div style="color: #667eea;">ğŸšš ì§„í–‰ì¤‘: ${transitCount}ê±´</div>
                        <div style="color: #ffa502;">â³ ëŒ€ê¸°: ${pendingCount}ê±´</div>
                        <div style="color: #ff4757;">âš ï¸ ì§€ì—°: ${delayedCount}ê±´</div>
                    </div>
                    <div style="margin-bottom: 0.5rem;">
                        <div style="background: rgba(255,255,255,0.2); height: 8px; border-radius: 4px; overflow: hidden;">
                            <div style="background: #2ed573; height: 100%; width: ${Math.round((completedCount / driver.deliveries.length) * 100)}%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div style="font-size: 0.9rem; font-weight: bold; color: white; text-align: center;">
                        ì§„í–‰ë¥ : ${Math.round((completedCount / driver.deliveries.length) * 100)}% 
                        (${completedCount}/${driver.deliveries.length})
                    </div>
                </div>
                
                <button class="btn btn-secondary" onclick="exitDetailMode()" style="width: 100%; margin-bottom: 1rem;">
                    â† ì „ì²´ ë³´ê¸°ë¡œ ëŒì•„ê°€ê¸°
                </button>
                
                <div class="section-title" style="font-size: 0.8rem; margin-bottom: 0.5rem;">ğŸ“‹ ë°°ì†¡ì§€ ëª©ë¡ (${driver.deliveries.length}ê±´)</div>
                <div style="max-height: 400px; overflow-y: auto; scrollbar-width: thin;">
                    ${driver.deliveries.map((delivery, index) => `
                        <div class="delivery-item" data-status="${delivery.status}" onclick="focusDelivery('${driverId}', ${index})" 
                             style="margin-bottom: 0.3rem; padding: 0.7rem; font-size: 0.75rem;
                                    border-left: 3px solid ${
                                        delivery.status === 'delivered' ? '#888888' :
                                        delivery.status === 'transit' ? '#2ed573' :
                                        delivery.status === 'pending' ? '#ffa502' : '#ff4757'
                                    };">
                            <div class="delivery-header">
                                <span class="delivery-id" style="font-weight: bold;">
                                    ${index + 1}. ${delivery.id}
                                </span>
                                <span class="status-badge status-${delivery.status}">
                                    ${delivery.status === 'delivered' ? 'ì™„ë£Œ' :
                                      delivery.status === 'transit' ? 'ë°°ì†¡ì¤‘' :
                                      delivery.status === 'pending' ? 'ëŒ€ê¸°' : 'ì§€ì—°'}
                                </span>
                            </div>
                            <div class="delivery-address" style="margin: 0.3rem 0; font-size: 0.7rem;">
                                ${delivery.address}
                            </div>
                            <div class="delivery-meta" style="font-size: 0.65rem;">
                                <span class="priority-${delivery.priority}">
                                    ${delivery.priority === 'high' ? 'ğŸ”¥ ê¸´ê¸‰' : 'ğŸ“¦ ì¼ë°˜'}
                                </span>
                                <span>${delivery.completedAt || delivery.estimatedTime || 'ì‹œê°„ ë¯¸ì •'}</span>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // ë°°ì†¡ì§€ í¬ì»¤ìŠ¤
        function focusDelivery(driverId, deliveryIndex) {
            const delivery = driversData[driverId].deliveries[deliveryIndex];
            map.setView(delivery.position, 16);
            
            // í•´ë‹¹ ë§ˆì»¤ íŒì—… ì—´ê¸°
            if (deliveryMarkers[driverId] && deliveryMarkers[driverId][deliveryIndex]) {
                deliveryMarkers[driverId][deliveryIndex].openPopup();
            }
        }

        // ê¸°ì‚¬ í† ê¸€
        function toggleDriver(driverId, chipElement) {
            document.querySelectorAll('.driver-chip').forEach(chip => chip.classList.remove('selected'));
            chipElement.classList.add('selected');
            
            currentSelectedDriver = driverId;
            
            if (driverId === 'all') {
                Object.keys(driversData).forEach(id => {
                    if (!driverMarkers[id]) showDriver(id);
                });
                map.setView([37.5665, 126.9780], 10);
            } else {
                Object.keys(driversData).forEach(id => {
                    if (id === driverId) {
                        if (!driverMarkers[id]) showDriver(id);
                        map.setView(driversData[id].position, 13);
                    } else {
                        hideDriver(id);
                    }
                });
            }
        }

        // ìƒì„¸ ëª¨ë“œ ì¢…ë£Œ
        function exitDetailMode() {
            currentDetailDriver = null;
            hideAlert();
            
            // ëª¨ë“  ê¸°ì‚¬ ë‹¤ì‹œ í‘œì‹œ
            showAllDrivers();
            
            // ì‚¬ì´ë“œë°”ë¥¼ ì›ë˜ ë°°ì†¡ ëª©ë¡ìœ¼ë¡œ ë³µì›
            createInitialDeliveryList();
            
            // ì§€ë„ ì¤‘ì‹¬ ë³µì›
            map.setView([37.5665, 126.9780], 10);
        }

        // ìœ„í—˜ì§€ì—­ í† ê¸€
        function toggleDangerZones() {
            dangerZonesVisible = !dangerZonesVisible;
            
            if (dangerZonesVisible) {
                showDangerZones();
                
                const alertPanel = document.getElementById('alertPanel');
                alertPanel.className = 'alert-panel warning';
                alertPanel.innerHTML = `
                    <button class="alert-close" onclick="hideAlert()">Ã—</button>
                    <div class="alert-title">ğŸš¨ ìœ„í—˜ì§€ì—­ í‘œì‹œ í™œì„±í™”</div>
                    <div class="alert-content">
                        <strong>ë¹¨ê°„ìƒ‰:</strong> ë†’ì€ ìœ„í—˜ â€¢ <strong>ì£¼í™©ìƒ‰:</strong> ë³´í†µ ìœ„í—˜ â€¢ <strong>ë…¸ë€ìƒ‰:</strong> ë‚®ì€ ìœ„í—˜<br>
                        ì‹¤ì‹œê°„ êµí†µìƒí™©ê³¼ ì‚¬ê³  ë‹¤ë°œì§€ì—­ì„ í‘œì‹œí•©ë‹ˆë‹¤.
                    </div>
                `;
                alertPanel.style.display = 'block';
            } else {
                hideDangerZones();
                hideAlert();
            }
        }

        // ìœ„í—˜ì§€ì—­ í‘œì‹œ
        function showDangerZones() {
            dangerZoneData.forEach((zone, index) => {
                const colors = {
                    'high': '#ff4757',
                    'medium': '#ffa502',
                    'low': '#f1c40f'
                };
                
                const circle = L.circle(zone.center, {
                    color: colors[zone.level],
                    fillColor: colors[zone.level],
                    fillOpacity: 0.2,
                    radius: zone.radius,
                    weight: 2,
                    opacity: 0.8
                }).addTo(map);
                
                circle.bindPopup(`
                    <div style="color: #333; font-weight: bold; margin-bottom: 4px;">
                        ğŸš¨ ${zone.name}
                    </div>
                    <div style="color: #666; font-size: 12px; margin-bottom: 4px;">
                        ìœ„í—˜ë„: ${zone.level === 'high' ? 'ë†’ìŒ' : 
                                zone.level === 'medium' ? 'ë³´í†µ' : 'ë‚®ìŒ'}
                    </div>
                    <div style="color: #666; font-size: 11px;">
                        ì‚¬ìœ : ${zone.reason}
                    </div>
                    <div style="margin-top: 6px; font-size: 10px; color: #999;">
                        ë°˜ê²½: ${zone.radius}m
                    </div>
                `);
                
                dangerZones.push(circle);
            });
        }

        // ìœ„í—˜ì§€ì—­ ìˆ¨ê¸°ê¸°
        function hideDangerZones() {
            dangerZones.forEach(zone => map.removeLayer(zone));
            dangerZones = [];
        }

        // ì§€ë„ ì¤‘ì‹¬í™”
        function centerMap() {
            if (currentDetailDriver) {
                const driver = driversData[currentDetailDriver];
                const bounds = L.latLngBounds([driver.position]);
                driver.deliveries.forEach(delivery => bounds.extend(delivery.position));
                map.fitBounds(bounds, { padding: [50, 50] });
            } else {
                map.setView([37.5665, 126.9780], 10);
            }
        }

        // ì „ì²´í™”ë©´ í† ê¸€
        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
            } else {
                document.exitFullscreen();
            }
        }

        // ì•Œë¦¼ ìˆ¨ê¸°ê¸°
        function hideAlert() {
            const alertPanel = document.getElementById('alertPanel');
            alertPanel.style.display = 'none';
        }

        // ì „ì²´ ê²½ë¡œ ìµœì í™”
        function optimizeAllRoutes() {
            const activeDrivers = Object.keys(driversData).filter(id => 
                driversData[id].status === 'active' || driversData[id].status === 'busy'
            );
            
            activeDrivers.forEach(driverId => {
                if (driverMarkers[driverId]) {
                    if (currentDetailDriver === driverId) {
                        calculateDetailedRoute(driverId);
                    } else {
                        const driver = driversData[driverId];
                        const activeDeliveries = driver.deliveries.filter(d => d.status !== 'delivered').slice(0, 3);
                        if (activeDeliveries.length > 0) {
                            calculateBasicRoute(driverId, activeDeliveries);
                        }
                    }
                }
            });
            
            const alertPanel = document.getElementById('alertPanel');
            alertPanel.className = 'alert-panel warning';
            alertPanel.innerHTML = `
                <button class="alert-close" onclick="hideAlert()">Ã—</button>
                <div class="alert-title">âœ… ì „ì²´ ê²½ë¡œ ìµœì í™” ì™„ë£Œ</div>
                <div class="alert-content">
                    ${activeDrivers.length}ëª… ê¸°ì‚¬ ê²½ë¡œ ìµœì í™” ì™„ë£Œ<br>
                    ì˜ˆìƒ ì‹œê°„ ë‹¨ì¶•: í‰ê·  18% â€¢ ì—°ë£Œë¹„ ì ˆì•½: 12%
                </div>
            `;
            alertPanel.style.display = 'block';
            setTimeout(() => hideAlert(), 5000);
        }

        // ì§€ë„ ìƒˆë¡œê³ ì¹¨
        function refreshMap() {
            map.invalidateSize();
            
            // ê¸°ì‚¬ ìœ„ì¹˜ ì•½ê°„ì”© ì—…ë°ì´íŠ¸ (ì‹¤ì‹œê°„ ì‹œë®¬ë ˆì´ì…˜)
            Object.entries(driversData).forEach(([driverId, driver]) => {
                if (driverMarkers[driverId] && driver.status === 'active') {
                    const newLat = driver.position[0] + (Math.random() - 0.5) * 0.001;
                    const newLng = driver.position[1] + (Math.random() - 0.5) * 0.001;
                    driverMarkers[driverId].setLatLng([newLat, newLng]);
                    driver.position = [newLat, newLng];
                }
            });
            
            const alertPanel = document.getElementById('alertPanel');
            alertPanel.className = 'alert-panel info';
            alertPanel.innerHTML = `
                <button class="alert-close" onclick="hideAlert()">Ã—</button>
                <div class="alert-title">ğŸ”„ ì‹¤ì‹œê°„ ë°ì´í„° ì—…ë°ì´íŠ¸</div>
                <div class="alert-content">
                    ê¸°ì‚¬ ìœ„ì¹˜ ë° ë°°ì†¡ í˜„í™©ì´ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.
                </div>
            `;
            alertPanel.style.display = 'block';
            setTimeout(() => hideAlert(), 3000);
        }

        // êµí†µì •ë³´ í† ê¸€
        let trafficVisible = false;
        function toggleTraffic() {
            trafficVisible = !trafficVisible;
            const alertPanel = document.getElementById('alertPanel');
            
            if (trafficVisible) {
                alertPanel.className = 'alert-panel warning';
                alertPanel.innerHTML = `
                    <button class="alert-close" onclick="hideAlert()">Ã—</button>
                    <div class="alert-title">ğŸš¦ ì‹¤ì‹œê°„ êµí†µì •ë³´</div>
                    <div class="alert-content">
                        <strong>ğŸ”´ ì‹¬í•œ ì •ì²´:</strong> ê°•ë‚¨ëŒ€ë¡œ, í…Œí—¤ë€ë¡œ, ì—¬ì˜ëŒ€ë¡œ<br>
                        <strong>ğŸŸ¡ ë³´í†µ ì •ì²´:</strong> í™ëŒ€ì…êµ¬ì—­, ì ì‹¤ì—­ ì¼ëŒ€<br>
                        <strong>ğŸŸ¢ ì›í™œ:</strong> ê°•ì„œêµ¬, ì„±ë¶êµ¬, êµ¬ë¡œêµ¬
                    </div>
                `;
                alertPanel.style.display = 'block';
            } else {
                hideAlert();
            }
        }

        // ë°°ì†¡ ê²€ìƒ‰ í•„í„°
        function filterDeliveries(searchTerm) {
            const deliveryList = document.getElementById('deliveryList');
            const items = deliveryList.getElementsByClassName('delivery-item');
            
            for (let item of items) {
                const text = item.textContent.toLowerCase();
                if (text.includes(searchTerm.toLowerCase())) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            }
        }

        // ìƒíƒœë³„ í•„í„°
        function filterByStatus(status) {
            document.querySelectorAll('.filter-tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');

            const deliveryList = document.getElementById('deliveryList');
            const items = deliveryList.getElementsByClassName('delivery-item');
            
            for (let item of items) {
                if (status === 'all' || item.getAttribute('data-status') === status) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            }
        }

        // ë°°ì†¡ ì¶”ì 
        function trackDelivery(trackingNumber) {
            const alertPanel = document.getElementById('alertPanel');
            alertPanel.className = 'alert-panel info';
            alertPanel.innerHTML = `
                <button class="alert-close" onclick="hideAlert()">Ã—</button>
                <div class="alert-title">ğŸ“¦ ${trackingNumber} ì‹¤ì‹œê°„ ì¶”ì </div>
                <div class="alert-content">
                    í˜„ì¬ ìœ„ì¹˜: GPS ì¢Œí‘œ ì¶”ì  ì¤‘<br>
                    ì˜ˆìƒ ë„ì°©: 30ë¶„ ë‚´ â€¢ ê³ ê° ì—°ë½ì²˜: 010-****-****
                </div>
            `;
            alertPanel.style.display = 'block';
        }

        // ì•Œë¦¼ í‘œì‹œ
        function showNotifications() {
            const alertPanel = document.getElementById('alertPanel');
            alertPanel.className = 'alert-panel';
            alertPanel.innerHTML = `
                <button class="alert-close" onclick="hideAlert()">Ã—</button>
                <div class="alert-title">ğŸ”” ìƒˆë¡œìš´ ì•Œë¦¼ 3ê±´</div>
                <div class="alert-content">
                    ğŸš¨ <strong>ê¸´ê¸‰:</strong> ê°•ë‚¨êµ¬ êµí†µì²´ì¦ìœ¼ë¡œ 3ê±´ ì§€ì—°<br>
                    ğŸ“¦ <strong>ì¼ë°˜:</strong> ìƒˆ ì£¼ë¬¸ 15ê±´ ì ‘ìˆ˜ ëŒ€ê¸°<br>
                    âš™ï¸ <strong>ì‹œìŠ¤í…œ:</strong> ì•¼ê°„ ì„œë²„ ì ê²€ ì˜ˆì • (23:00-01:00)
                </div>
            `;
            alertPanel.style.display = 'block';
        }

        // ì‹¤ì‹œê°„ í†µê³„ ì—…ë°ì´íŠ¸
        function updateStats() {
            const statValues = document.querySelectorAll('.stat-value');
            const baseValues = [3247, 542, 43, 20];
            
            statValues.forEach((element, index) => {
                if (Math.random() > 0.92) { // 8% í™•ë¥ ë¡œ ì—…ë°ì´íŠ¸
                    const variation = Math.floor(Math.random() * 20) - 10; // -10 ~ +10 ë³€ë™
                    const newValue = Math.max(0, baseValues[index] + variation);
                    element.textContent = newValue.toLocaleString();
                    element.classList.add('animate-pulse');
                    setTimeout(() => element.classList.remove('animate-pulse'), 1000);
                }
            });
        }

        // ì´ˆê¸°í™”
        window.onload = function() {
            initializeMap();
            setInterval(updateStats, 5000);
            
            // 5ì´ˆ í›„ ì•Œë¦¼ ìë™ ìˆ¨ê¹€
            setTimeout(() => hideAlert(), 5000);
            
            console.log('QuickLog TMS v2.1 ì „ì²´ ë²„ì „ ë¡œë“œ ì™„ë£Œ');
            console.log('- 20ëª… ê¸°ì‚¬ ì‹œìŠ¤í…œ í™œì„±í™”');
            console.log('- ì‹¤ì‹œê°„ ìœ„í—˜ì§€ì—­ ëª¨ë‹ˆí„°ë§ í™œì„±í™”');
            console.log('- ìƒì„¸ ê´€ì œ ëª¨ë“œ í™œì„±í™”');
        }

        // í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                if (currentDetailDriver) {
                    exitDetailMode();
                } else {
                    hideAlert();
                }
            } else if (e.key === 'F11') {
                e.preventDefault();
                toggleFullscreen();
            } else if (e.ctrlKey && e.key === 'r') {
                e.preventDefault();
                refreshMap();
            } else if (e.key === 'Tab') {
                e.preventDefault();
                toggleSidebar();
            } else if (e.key === 'd' && e.ctrlKey) {
                e.preventDefault();
                toggleDangerZones();
            }
        });
    </script>
</body>
</html>
